# DeepWrite 后端技术选型锁定

## 核心技术栈

### 网关层
- **API网关**: Spring Cloud Gateway
- **功能**: 路由转发、全局鉴权(GlobalFilter)、流量控制(Sentinel)、跨域配置(CORS)
- **版本**: Spring Cloud 2023.x (适配 Spring Boot 3.2)

### 微服务框架
- **核心框架**: Spring Boot 3.2.x
- **通信协议**: 
    - **内部调用**: **Apache Dubbo 3.2.x (RPC)**
    - **AI流式**: SSE (Server-Sent Events)
- **服务注册与配置**: Alibaba Nacos 2.3.x

### 数据存储
- **关系数据库**: MySQL 8.0
- **ORM框架**: MyBatis-Plus 3.5.x
    - **使用原则**: 单表简单 CRUD 使用 MP；多表关联、复杂报表强制使用 XML 原生 SQL。
    - **领域隔离**: 禁止在 Domain 层直接依赖 MP 的 Wrapper 类。
- **数据库迁移**: Flyway 9.x
- **缓存**: Redis 7.x

### 消息队列
- **MQ**: Apache RocketMQ 5.1.x
- **用途**: 
    - 削峰填谷：AI 任务排队
    - 异步解耦：生成完成后的通知、计费扣减

### AI集成
- **框架**: **Native Java 11 HttpClient** (弃用 Spring AI 以提升可控性)
- **LLM Provider**: Google Gemini API (REST)
- **功能**: 
    - 手动封装 Prompt
    - JSON 解析 (Jackson)

## 基础设施

### 部署环境
- **云平台**: 阿里云 ECS
- **容器化**: Docker + Docker Compose (开发/测试), K8s (生产备选)
- **代码仓库模式**: Monorepo (Maven Multi-module)

### CI/CD
- **版本控制**: GitHub
- **自动化**: GitHub Actions (CI 构建/测试)

## 开发规范

### 编码标准
- **语言**: **Java 11** (LTS 版本)
- **依赖管理**: Maven
- **架构模式**: 
    - **dw-core**: 轻量级 DDD (Domain-Driven Design)
    - **dw-gateway/auth**: 贫血模型 MVC
- **代码风格**: Alibaba Java Coding Guidelines

### 安全规范
- **认证授权**: JWT + Refresh Token
- **网关鉴权**: 在 Gateway 层解析 Token，透传 UserID Header 给下游
- **数据加密**: 敏感字段 (API Key, 密码) 加密存储

## 锁定原则

### 技术栈锁定
- ✅ **已锁定技术栈**不得随意更改
- ✅ **核心组件**版本需要经过兼容性测试

---
技术栈锁定日期: 2025-11-28
适用范围: DeepWrite 后端服务
版本: v1.1.0 (Updated)
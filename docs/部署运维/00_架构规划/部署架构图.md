# DeepWrite 分布式部署架构

## 1. 整体拓扑图

```mermaid
graph TD
    User[用户] --> |HTTP/HTTPS| Nginx[Nginx (ECS A)]
    
    subgraph "ECS A (控制节点)"
        Nginx --> |/api| Gateway[dw-gateway]
        Gateway --> |Auth| Auth[dw-auth]
        Gateway --> |Discovery| Nacos[Nacos Server]
        
        Auth -.-> |Register| Nacos
        Gateway -.-> |Register| Nacos
    end
    
    subgraph "ECS B (计算节点)"
        Gateway --> |RPC/HTTP (内网)| Core[dw-core]
        Core -.-> |Register| Nacos
    end
    
    subgraph "阿里云基础服务"
        RDS[(MySQL RDS)]
        Redis[(Redis)]
    end
    
    Auth --> RDS
    Core --> RDS
    Core --> Redis
    Nacos --> RDS
```

## 2. 服务器角色规划

### ECS A (控制节点)
- **公网 IP**: `47.114.90.156`
- **内网 IP**: `(待补充)`
- **部署服务**:
  - **Nginx**: 前端静态资源 + 反向代理。
  - **Nacos**: 注册中心与配置中心。
  - **dw-gateway**: 流量入口，负责路由和鉴权。
  - **dw-auth**: 用户认证服务。

### ECS B (计算节点)
- **公网 IP**: `47.99.32.144`
- **内网 IP**: `(待补充)`
- **部署服务**:
  - **dw-core**: 核心写作业务 (AI 生成、文档管理)。
  - **RocketMQ** (规划中): 异步任务队列。

## 3. 网络策略
- **对外暴露**: 仅 ECS A 开放 80/443 端口。
- **对内通信**: 所有服务间调用（如 Gateway -> Core）必须走 **ECS 内网 IP** 以降低延迟和费用。
- **Docker 网络**: 使用 `host` 模式或端口映射，确保服务注册到 Nacos 的 IP 是 ECS 的内网 IP，而非 Docker 容器 IP。
